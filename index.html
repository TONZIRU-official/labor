<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬å››å¼·åˆ¶åŠ´åƒåŒº</title>
    <style>
        body { background: #000; color: #0f0; font-family: sans-serif; text-align: center; margin: 0; overflow: hidden; height: 100vh; touch-action: manipulation; user-select: none; }
        #error-screen { display: none; padding-top: 30vh; color: #ff4444; }
        #game-screen { display: none; width: 100vw; height: 100vh; position: relative; background: #050505; }
        #ui { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.9); padding: 10px; border-bottom: 2px solid #333; z-index: 1000; }
        .rock { position: absolute; font-size: 80px; transform: translate(-50%, -50%); cursor: pointer; z-index: 500; display: block; -webkit-tap-highlight-color: transparent; }
        .rock:active { transform: translate(-50%, -50%) scale(0.8); }
        #finish-screen { display: none; padding-top: 20vh; }
        .code-box { color: #ff0; font-size: 24px; border: 2px dashed #ff0; padding: 15px; display: block; margin: 20px auto; background: #111; width: 80%; word-break: break-all; }
        .copy-btn { background: #0f0; color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="error-screen"><h1>âš ï¸ ACCESS DENIED</h1><p>Discordã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„</p></div>

    <div id="game-screen">
        <div id="ui"><h2 id="counter">é€²æ—: 0 / 200</h2><div id="status">çŸ³ã‚’å©ã‘ï¼</div></div>
        <div id="rock" class="rock" onclick="hit()">ğŸª¨</div>
    </div>

    <div id="finish-screen">
        <h1>â›ï¸ ä½œæ¥­å®Œäº† â›ï¸</h1>
        <p>å®Œäº†ã‚³ãƒ¼ãƒ‰:</p>
        <div id="resultCode" class="code-box"></div>
        <button class="copy-btn" onclick="copyCode()">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
        <p style="font-size: 0.8em; margin-top: 20px;">ã‚³ãƒ”ãƒ¼ã—ã¦Discordã® /claim ã§å ±å‘Šã›ã‚ˆ<br>å ±å‘Šå¾Œã¯ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã™ã‚Œã°å†åŠ´åƒå¯èƒ½ã </p>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const uid = urlParams.get('id');
        const rock = document.getElementById('rock');

        if (!uid || isNaN(uid) || uid.length < 15) {
            document.getElementById('error-screen').style.display = 'block';
        } else {
            document.getElementById('game-screen').style.display = 'block';
            move();
        }

        let count = 0;
        const quota = 200;

        function generateSecret(id) {
            const now = new Date();
            // 10ç§’ã”ã¨ã«å€¤ãŒå¤‰ã‚ã‚‹ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€é€£ç¶šã‚¯ãƒªã‚¢ã—ã¦ã‚‚åˆ¥ã®ã‚³ãƒ¼ãƒ‰ã«ãªã‚‹
            const timeKey = Math.floor(now.getTime() / 10000); 
            const salt = "SECRET_ZIMU_99"; 
            const raw = id + timeKey + salt;
            let hash = 0;
            for (let i = 0; i < raw.length; i++) {
                hash = ((hash << 5) - hash) + raw.charCodeAt(i);
                hash |= 0; 
            }
            return "RX-" + Math.abs(hash).toString(36).toUpperCase() + "-" + btoa(id + timeKey).slice(-5).toUpperCase();
        }

        function move() {
            const x = Math.floor(Math.random() * 70) + 15;
            const y = Math.floor(Math.random() * 60) + 25;
            rock.style.left = x + "%";
            rock.style.top = y + "%";
        }

        function hit() {
            if (count >= quota) return;
            count++;
            document.getElementById('counter').innerText = `é€²æ—: ${count} / ${quota}`;
            move();
            if (count >= quota) {
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('finish-screen').style.display = 'block';
                document.getElementById('resultCode').innerText = generateSecret(uid);
            }
        }

        function copyCode() {
            const code = document.getElementById('resultCode').innerText;
            navigator.clipboard.writeText(code).then(() => { alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); });
        }
    </script>
</body>
</html>

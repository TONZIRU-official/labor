<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°ä¸‹åŠ´åƒæ–½è¨­ - æ¥µé™ä½œæ¥­åŒº</title>
    <script src="https://cdn.jsdelivr.net/npm/@discord/embedded-app-sdk@1.0.0/dist/index.js"></script>
    <style>ã‚
        body {
            background: #000; color: #0f0; font-family: 'Consolas', monospace;
            overflow: hidden; height: 100vh; margin: 0; user-select: none;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        #ui {
            position: fixed; top: 0; width: 100%; text-align: center;
            background: rgba(0,0,0,0.8); z-index: 10; padding: 10px 0; border-bottom: 1px solid #333;
        }
        #game-canvas {
            width: 100vw; height: 100vh; position: relative;
            /* èƒŒæ™¯å…¨ä½“ãŒã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ãªã‚‹ã‚ˆã†è¨­å®š */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"><text x="0" y="25" style="font-size: 25px;">â›ï¸</text></svg>') 15 15, auto;
        }
        .rock {
            position: absolute; font-size: 80px; transition: 0.1s;
            transform: translate(-50%, -50%); /* ä¸­å¤®æƒãˆ */
            filter: drop-shadow(0 0 10px #555);
            pointer-events: none; /* å²©è‡ªä½“ã¯ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šãªã— */
        }
        .blackout {
            position: fixed; top:0; left:0; width:100%; height:100%; background:#000;
            display:none; z-index:1000; align-items:center; justify-content:center; color:red; font-size:30px;
        }
        #progress-bar { width: 80%; height: 10px; border: 1px solid #0f0; margin: 10px auto; }
        #progress-fill { width: 0%; height: 100%; background: #0f0; transition: 0.2s; }
        .code-display { color: yellow; font-size: 24px; border: 2px dashed yellow; padding: 10px; margin-top: 20px; display: inline-block; }
    </style>
</head>
<body>

<div id="ui">
    <div>â›ï¸ ç¬¬å››å¼·åˆ¶åŠ´åƒåŒº â›ï¸</div>
    <div id="progress-bar"><div id="progress-fill"></div></div>
    <div id="counter">é€²æ—: 0 / 200</div>
    <div id="status" style="font-size: 12px; color: #888;">èƒŒæ™¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦çŸ³ã‚’ç •ã‘ï¼</div>
</div>

<div id="game-canvas">
    <div id="rock" class="rock">ğŸª¨</div>
</div>

<div id="blackout" class="blackout">âš ï¸ åœé›»ä¸­ï¼šå¾©æ—§ã¾ã§å¾…æ©Ÿã›ã‚ˆ âš ï¸</div>

<script>
    // --- åˆæœŸè¨­å®š ---
    const TARGET_ID = "1455043505750806703"; // â˜…Botã®Application ID
    const QUOTA = 200;
    let count = 0;
    let isBlackout = false;

    const gameCanvas = document.getElementById('game-canvas');
    const rock = document.getElementById('rock');
    const counterText = document.getElementById('counter');
    const fill = document.getElementById('progress-fill');
    const status = document.getElementById('status');
    const blackout = document.getElementById('blackout');

    // æ—¥æ›¿ã‚ã‚Šã‚³ãƒ¼ãƒ‰ (Botå´ã¨ä¸€è‡´)
    const dateStr = new Date().toISOString().slice(0, 10);
    const dailyCode = "LABOR-" + btoa(dateStr).slice(0, 5).toUpperCase();

    // --- Discord SDK åˆæœŸåŒ– (å¤±æ•—ã—ã¦ã‚‚ç„¡è¦–ã—ã¦é€²ã‚€) ---
    async function initSDK() {
        try {
            const discordSdk = new window.discordSdk.DiscordSDK(TARGET_ID);
            await discordSdk.ready();
            console.log("Discord SDK Ready");
        } catch (e) {
            console.log("Running in browser mode (Discord SDK not loaded)");
        }
    }
    initSDK();

    // --- å²©ã®ç§»å‹• ---
    function moveRock() {
        const x = Math.random() * (window.innerWidth - 100) + 50; // ç”»é¢ç«¯ã«å¯„ã‚Šã™ããªã„ã‚ˆã†ã«èª¿æ•´
        const y = Math.random() * (window.innerHeight - 200) + 100; // UIã¨ã‹ã¶ã‚‰ãªã„ã‚ˆã†ã«èª¿æ•´
        rock.style.left = x + "px";
        rock.style.top = y + "px";
    }

    // --- åœé›»ã‚¤ãƒ™ãƒ³ãƒˆ ---
    function triggerBlackout() {
        if (isBlackout) return;
        isBlackout = true;
        blackout.style.display = 'flex';
        status.innerText = "ğŸš¨ åœé›»ç™ºç”Ÿï¼ä½œæ¥­ä¸­æ–­ï¼";
        status.style.color = "red";
        setTimeout(() => {
            blackout.style.display = 'none';
            isBlackout = false;
            status.innerText = "âš™ï¸ ä½œæ¥­å†é–‹";
            status.style.color = "#888";
        }, 3500); // 3.5ç§’é–“åœé›»
    }

    // --- ã‚¯ãƒªãƒƒã‚¯å‡¦ç† (èƒŒæ™¯å…¨ä½“ã§åˆ¤å®š) ---
    gameCanvas.onclick = (e) => {
        if (isBlackout || count >= QUOTA) return;

        // 15%ã®ç¢ºç‡ã§å¤±æ•— (ç©ºæŒ¯ã‚Š)
        if (Math.random() < 0.15) {
            status.innerText = "âŒ ç©ºæŒ¯ã‚Šï¼ã‚‚ã£ã¨é›†ä¸­ã—ã‚ï¼";
            status.style.color = "red";
            return; // ã‚«ã‚¦ãƒ³ãƒˆã¯å¢—ãˆãªã„
        }

        count++;
        status.innerText = "âœ… æ¡æ˜æˆåŠŸ";
        status.style.color = "#0f0";
        
        // UIæ›´æ–°
        counterText.innerText = `é€²æ—: ${count} / ${QUOTA}`;
        fill.style.width = (count / QUOTA * 100) + "%";

        // å²©ã‚’é€ƒãŒã™
        moveRock();

        // 50å›ã”ã¨ã«åœé›»
        if (count % 50 === 0 && count < QUOTA) {
            triggerBlackout();
        }

        // å®Œäº†
        if (count >= QUOTA) {
            gameCanvas.style.cursor = 'default';
            rock.style.display = "none";
            document.getElementById('ui').innerHTML = `
                <h1>ğŸ‰ ãƒãƒ«ãƒé”æˆ ğŸ‰</h1>
                <div class="code-display">ã‚³ãƒ¼ãƒ‰: ${dailyCode}</div>
                <p>ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ Discord ã® /claim ã‚³ãƒãƒ³ãƒ‰ã§å ±å‘Šã—ã‚ã€‚</p>
            `;
        }
    };

    // åˆæœŸä½ç½®
    moveRock();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¬¬å››å¼·åˆ¶åŠ´åƒåŒº</title>
    <style>
        body { background: #000; color: #0f0; font-family: sans-serif; text-align: center; margin: 0; overflow: hidden; height: 100vh; touch-action: none; user-select: none; }
        #error-screen { display: none; padding-top: 30vh; color: #ff4444; }
        #game-screen { display: none; width: 100vw; height: 100vh; position: relative; background: #050505; transition: background 0.2s; }
        
        /* UI */
        #ui { position: fixed; top: 0; width: 100%; background: rgba(0,0,0,0.9); padding: 10px; border-bottom: 2px solid #333; z-index: 1000; }
        #status { color: #ff0; font-size: 0.9em; margin-top: 5px; }

        /* çŸ³ */
        .rock { position: absolute; font-size: 80px; transform: translate(-50%, -50%); cursor: pointer; z-index: 500; display: block; -webkit-tap-highlight-color: transparent; transition: left 0.1s, top 0.1s; }
        .rock:active { transform: translate(-50%, -50%) scale(0.7); }

        /* åœé›» */
        #blackout {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; pointer-events: none; z-index: 800; opacity: 0;
            mask-image: radial-gradient(circle 100px at var(--x) var(--y), transparent 100%, black 100%);
            -webkit-mask-image: radial-gradient(circle 100px at var(--x) var(--y), transparent 80%, black 100%);
        }

        #finish-screen { display: none; padding-top: 20vh; }
        .code-box { color: #ff0; font-size: 24px; border: 2px dashed #ff0; padding: 15px; display: block; margin: 20px auto; background: #111; width: 80%; word-break: break-all; }
        .copy-btn { background: #0f0; color: #000; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; }
        
        .danger { animation: shake 0.1s infinite; color: #f00 !important; }
        @keyframes shake { 0% { transform: translate(0); } 50% { transform: translate(2px, 2px); } 100% { transform: translate(0); } }
        
        #fatigue { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900; background: rgba(255,0,0,0); transition: background 0.5s; }
    </style>
</head>
<body onmousemove="updateLight(event)" ontouchmove="updateLight(event)">

    <div id="fatigue"></div>
    <div id="blackout"></div>

    <div id="error-screen"><h1>âš ï¸ ACCESS DENIED</h1><p>Discordã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„</p></div>

    <div id="game-screen">
        <div id="ui">
            <h2 id="counter">é€²æ—: 0 / 500</h2>
            <div id="status">çŸ³ã‚’å©ã‘ï¼</div>
        </div>
        <div id="rock" class="rock" onclick="hit(event)">ğŸª¨</div>
    </div>

    <div id="finish-screen">
        <h1>â›ï¸ ä½œæ¥­å®Œäº† â›ï¸</h1>
        <p>å®Œäº†ã‚³ãƒ¼ãƒ‰:</p>
        <div id="resultCode" class="code-box"></div>
        <button class="copy-btn" onclick="copyCode()">ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼</button>
        <p style="font-size: 0.8em; margin-top: 20px;">ã‚³ãƒ”ãƒ¼ã—ã¦Discordã® /claim ã§å ±å‘Šã›ã‚ˆ</p>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const uid = urlParams.get('id');
        const rock = document.getElementById('rock');
        const blackout = document.getElementById('blackout');
        const status = document.getElementById('status');
        const fatigue = document.getElementById('fatigue');

        let count = 0;
        const quota = 5; // 500å›ã«å¤‰æ›´
        let isBlackout = false;

        if (!uid || isNaN(uid) || uid.length < 15) {
            document.getElementById('error-screen').style.display = 'block';
        } else {
            document.getElementById('game-screen').style.display = 'block';
            move();
        }

        function updateLight(e) {
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            document.documentElement.style.setProperty('--x', x + 'px');
            document.documentElement.style.setProperty('--y', y + 'px');
        }

        function hit(e) {
            if (count >= quota) return;
            count++;
            document.getElementById('counter').innerText = `é€²æ—: ${count} / ${quota}`;
            
            if (count === 125) status.innerText = "ã¾ã ã¾ã ã ãã€‚";
            if (count === 250) {
                status.innerText = "åŠåˆ†ã ã€‚çŸ³ãŒç¡¬ããªã£ã¦ããŸã€‚";
                rock.innerText = "â›ï¸"; 
            }
            if (count === 400) {
                status.innerText = "ã‚ã¨å°‘ã—ã ã€æ­»ã¬æ°—ã§å©ã‘ï¼";
                status.classList.add('danger');
                fatigue.style.background = "rgba(255, 0, 0, 0.2)";
            }

            if (count > 30 && Math.random() < 0.05 && !isBlackout) triggerBlackout();

            move();

            if (count >= quota) {
                isBlackout = false;
                blackout.style.opacity = 0;
                fatigue.style.background = "transparent";
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('finish-screen').style.display = 'block';
                document.getElementById('resultCode').innerText = generateSecret(uid);
            }
        }

        function triggerBlackout() {
            isBlackout = true;
            blackout.style.opacity = 1;
            const originalStatus = status.innerText;
            status.innerText = "âš ï¸ åœé›»ç™ºç”Ÿï¼æ‰‹å…ƒã‚’ç…§ã‚‰ã—ã¦çŸ³ã‚’æ¢ã›ï¼";
            setTimeout(() => {
                isBlackout = false;
                blackout.style.opacity = 0;
                status.innerText = originalStatus;
            }, 3000 + Math.random() * 2000);
        }

        function move() {
            const size = Math.max(25, 80 - (count / 8));
            rock.style.fontSize = size + "px";
            const x = Math.floor(Math.random() * 75) + 12;
            const y = Math.floor(Math.random() * 65) + 20;
            rock.style.left = x + "%";
            rock.style.top = y + "%";
        }

        // --- Pythonã¨åŒæœŸã—ãŸã‚·ãƒ³ãƒ—ãƒ«è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
// --- è¶…ãƒ»å®‰å®šç‰ˆï¼šæ–‡å­—ã¨ã—ã¦å‡¦ç†ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ ---
        function generateSecret(id) {
            const now = new Date();
            // 1. ä»Šã®ã€Œåˆ†ã€ã‚’å–å¾—
            const timeKey = now.getMinutes(); 
            
            // 2. IDã‚’ã€Œæ–‡å­—(String)ã€ã¨ã—ã¦ç¢ºå®Ÿã«æ‰±ã„ã€å¾Œã‚ã‹ã‚‰4æ–‡å­—åˆ‡ã‚Šå‡ºã™
            const idStr = String(id);
            const last4 = idStr.slice(-4);
            
            // 3. åˆ‡ã‚Šå‡ºã—ãŸ4æ–‡å­—ã‚’ã€Œæ•°å€¤ã€ã«ç›´ã™
            const uidSuffix = parseInt(last4, 10);
            
            // 4. æ•°å€¤åŒå£«ã‚’è¶³ã—ã¦ã€WORK- ã‚’ã¤ã‘ã¦è¿”ã™
            const simpleCode = uidSuffix + timeKey;
            
            console.log("ç”Ÿæˆãƒ­ã‚°:", { "IDæœ«å°¾": uidSuffix, "ç¾åœ¨ã®åˆ†": timeKey, "çµæœ": simpleCode });
            return "WORK-" + simpleCode;
        }

        function copyCode() {
            const code = document.getElementById('resultCode').innerText;
            navigator.clipboard.writeText(code).then(() => { alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); });
        }
    </script>
</body>
</html>

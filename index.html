<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>大東州共和国総選挙</title>
    <style>
        :root { --main-color: #00ff41; --bg-color: #0d0d0d; }
        body { background-color: var(--bg-color); color: var(--main-color); font-family: 'Courier New', Courier, monospace; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { border: 2px solid var(--main-color); padding: 30px; max-width: 500px; width: 100%; box-shadow: 0 0 15px rgba(0, 255, 65, 0.3); background: rgba(0, 0, 0, 0.8); }
        h1 { text-align: center; border-bottom: 2px solid var(--main-color); padding-bottom: 10px; font-size: 1.5rem; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; background: #222; border: 1px solid var(--main-color); color: var(--main-color); box-sizing: border-box; outline: none; margin-bottom: 10px; font-size: 1rem; }
        button { width: 100%; padding: 15px; background: var(--main-color); color: #000; border: none; font-weight: bold; cursor: pointer; font-size: 1rem; transition: 0.3s; }
        button:hover { background: #00cc33; box-shadow: 0 0 10px var(--main-color); }
        button:disabled { background: #444; color: #888; cursor: not-allowed; }
        .status { margin-top: 15px; text-align: center; font-size: 0.9rem; min-height: 1.2em; color: #ff4d4d; }
        .footer { margin-top: 30px; font-size: 0.7rem; text-align: center; color: #555; }
        .vote-label { font-size: 0.8rem; color: #888; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>第一回大東州議会議員総選挙</h1>
    <p style="text-align:center; font-size: 0.8rem;">--- 大東州議会議員総選挙 投票所 ---</p>

    <div id="vote-section">
        <div class="form-group">
            <label for="mcid">Minecraft ID</label>
            <input type="text" id="mcid" placeholder="正確なMCIDを入力してください" required>
        </div>

        <div class="form-group">
            <label>投票先（別々の人を3名選択）</label>
            
            <div class="vote-label">1票目</div>
            <select class="candidate-select">
                <option value="">-- 候補者を選択 --</option>
                <option value="shotaro shizoka">shotaro shizoka (あいらぶカジノ党)</option>
                <option value="Touyu 893">Touyu 893 (豚汁党)</option>
                <option value="xTZxJP">xTZxJP（国民協同党）</option>
                <option value="LEMONZZKIRBY">LEMONZZKIRBY（次の家康党）</option>
                <option value="nyokki1958">nyokki1958（国民協同党）</option>
                <option value="Slightsum8834">Slightsum8834(自由国民党）</option>
            </select>

            <div class="vote-label">2票目</div>
            <select class="candidate-select">
                <option value="">-- 候補者を選択 --</option>
                <option value="shotaro shizoka">shotaro shizoka (あいらぶカジノ党)</option>
                <option value="Touyu 893">Touyu 893 (豚汁党)</option>
                <option value="xTZxJP">xTZxJP（国民協同党）</option>
                <option value="LEMONZZKIRBY">LEMONZZKIRBY（次の家康党）</option>
                <option value="nyokki1958">nyokki1958（国民協同党）</option>
                <option value="Slightsum8834">Slightsum8834(自由国民党）</option>
                <option value="白票">白票 (棄権)</option>
            </select>

            <div class="vote-label">3票目</div>
            <select class="candidate-select">
                <option value="">-- 候補者を選択 --</option>
                <option value="shotaro shizoka">shotaro shizoka (あいらぶカジノ党)</option>
                <option value="Touyu 893">Touyu 893 (豚汁党)</option>
                <option value="xTZxJP">xTZxJP（国民協同党）</option>
                <option value="LEMONZZKIRBY">LEMONZZKIRBY（次の家康党）</option>
                <option value="nyokki1958">nyokki1958（国民協同党）</option>
                <option value="Slightsum8834">Slightsum8834(自由国民党）</option>
                <option value="白票">白票 (棄権)</option>
            </select>
        </div>

        <button id="submitBtn" onclick="submitVote()">投票を送信</button>
        <div id="status" class="status"></div>
    </div>

    <div class="footer">
        &copy; 大東州共和国 選挙管理委員会<br>
        Powered by AI Election System
    </div>
</div>

<script>
    // 選挙人名簿（直接HTMLに保持）
    const VOTER_LIST = [
        "nyokki1958", "daran0289", "maikuraumai", "kenti7599", "SoftMusic096337", 
        "TempOwl79825726", "SlightSum8834", "yutakabicchi", "shotaro shizoka", "Tankichi1", 
        "Sora3055", "ShabbyRuby54641", "yuisyunn", "kiri5620", "xRqmuzzzL YT", 
        "WoodedTuba82716", "Ezipt3697", "y3ur1lala", "Harukaze4006", "RinRin404040", 
        "takubon0114", "ZeroPlayer1396", "K1hoOIE", "Hikaru bp", "kemi114", 
        "PaltryCow795892", "haruson7856", "BleakDread23911", "FleeingRat43895", "Nnz0313", 
        "shuji12324", "haruhi8395", "utte75877", "InlandVeil18339", "BlahColt4486", 
        "kitune0510", "MIYUKI20107577", "HardPigeon4047", "PairedLand4913", "hiyorispyair", 
        "DueMite4591", "yukiharu518817", "kouk9690", "Ram1117enter", "GCsTanzanite", 
        "haha70473", "Raika6605", "hagetarouSP", "tantanmendesu29", "atatan3",
        "TANAKA7403", "hamburger3584", "Touyu 893", "xTZxJP", "LEMONZZKIRBY", "wUuUw o0O",
        "ExpertDuck64957", "raipoyo114514", "tokonoma7723", "moroheiyoshi", "yuyuotouto1126"
    ];

    // デプロイしたGASのURLを入れてください
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyfHXAuqwDIQ5Pi65RIvZ9QiAmqWgunOfPQt9lWHrzsfVcCX_BAQS2bSy17QPR6131P/exec";

    async function submitVote() {
        const mcid = document.getElementById('mcid').value.trim();
        const selects = document.querySelectorAll('.candidate-select');
        const candidates = Array.from(selects).map(s => s.value);
        const btn = document.getElementById('submitBtn');
        const status = document.getElementById('status');

        // --- ① 名簿チェック ---
        if (!VOTER_LIST.includes(mcid)) {
            status.style.color = "#ff4d4d";
            status.innerText = "❌ あなたは選挙人名簿に登録がないか、MCIDが間違っています。";
            return;
        }

        if (!mcid || candidates.some(c => c === "")) {
            status.style.color = "#ff4d4d";
            status.innerText = "⚠️ 全ての項目を選択してください。";
            return;
        }

        // 重複チェック（白票以外）
        const realVotes = candidates.filter(c => c !== "白票");
        const uniqueVotes = new Set(realVotes);
        if (realVotes.length !== uniqueVotes.size) {
            status.style.color = "#ff4d4d";
            status.innerText = "⚠️ 同じ候補者に重複投票はできません。";
            return;
        }

        if (!confirm(`${mcid} として投票を送信します。よろしいですか？`)) return;

        btn.disabled = true;
        status.style.color = "var(--main-color)";
        status.innerText = "⏳ サーバーに送信中...";

        try {
            const response = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ mcid: mcid, candidates: candidates })
            });
            const result = await response.json();

            if (result.status === "success") {
                document.getElementById('vote-section').innerHTML = `
                    <h2 style="text-align:center;">投票完了</h2>
                    <p style="text-align:center;">受理されました。<br>大東州に栄光あれ</p>
                    <button onclick="location.reload()" style="margin-top:20px;">戻る</button>
                `;
            } else {
                status.style.color = "#ff4d4d";
                status.innerText = "❌ " + result.message;
                btn.disabled = false;
            }
        } catch (e) {
            status.style.color = "#ff4d4d";
            status.innerText = "❌ 送信失敗。";
            btn.disabled = false;
        }
    }
</script>
</body>
</html>
